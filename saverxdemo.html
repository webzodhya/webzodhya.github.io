<!DOCTYPE html>
<html>
<!--From https://codepen.io/frytyler/pen/EGdtg-->

<head>
  <meta charset="UTF-8">
  <title>SaverX Demo</title>
  <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Arimo' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Hind:300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">  -->
  <link rel="stylesheet" href="https://latex.now.sh/style.css">
</head>

<body>
  <div class="login">
    <h1>Saver-X Demo</h1>
    <img src="./assets/images/temp/comp.gif" height="250" width="250">

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Chillers</td>
          <td>2 Water Cooled Chillers</td>
        </tr>
        <tr>
          <td>AHUs</td>
          <td>4</td>
        </tr>
        <tr>
          <td>Location</td>
          <td>Chennai</td>
        </tr>
        <tr>
          <td>Duration</td>
          <td>One Month (July)</td>
        </tr>
      </tbody>
    </table>

    <table>
      <form method="post" id="saverxDemoForm">
        <p>Chilled Water Temperature Setpoint</p>
        <div>
          <input type="radio" id="six" name="cooling_water_temperature_setpoint" value="6" required="required">
          <label for="six">6</label>
          <input type="radio" id="seven" name="cooling_water_temperature_setpoint" value="7" required="required">
          <label for="six">7</label>
          <input type="radio" id="eight" name="cooling_water_temperature_setpoint" value="8" required="required">
          <label for="six">8</label>
          <input type="radio" id="nine" name="cooling_water_temperature_setpoint" value="9" required="required">
          <label for="six">9</label>
        </div>
        <p>Cooling Water Setpoint Temperature</p>
        <div>
          <input type="radio" id="six" name="chiller_setpoint_temperature" value="29" required="required">
          <label for="six">29</label>
          <input type="radio" id="seven" name="chiller_setpoint_temperature" value="30" required="required">
          <label for="six">30</label>
          <input type="radio" id="eight" name="chiller_setpoint_temperature" value="31" required="required">
          <label for="six">31</label>
        </div>
        <p>AHU Opening Percentage</p>
        <div>
          <input type="radio" id="eighty" name="ahu_opening_percentage" value="80" required="required">
          <label for="six">80%</label>
          <input type="radio" id="ninety" name="ahu_opening_percentage" value="90" required="required">
          <label for="six">90%</label>
          <input type="radio" id="hundred" name="ahu_opening_percentage" value="100" required="required">
          <label for="six">100%</label>
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-large" id="simulate">Simulate Energy Consumption with
          Model</button>
      </form>
    </table>
    <br>
    <br>
    <br>

    <h5 id="optimalresult" class="alert alert-dark" role="alert"></h5>

    <button onclick="displayGraph()" id="tooglebutton" style="display: none;">Toggle Day Graph</button>

    
    <img id="graph" src='' >
    <img id="daygraph" src='' style="display: none;">

    <script>
      function displayGraph() {
        var text = document.getElementById("daygraph");
        if (text.style.display == "none") {
          text.style.display = "block";
        } else {
          text.style.display = "none";
        }
      }
    </script>


    <script>
      const saverxDemoForm = document.getElementById('saverxDemoForm');
      saverxDemoForm.addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(saverxDemoForm).entries()

        let cooling_water_temperature_setpoint = document.getElementsByName('cooling_water_temperature_setpoint');
        let chiller_setpoint_temperature= document.getElementsByName('chiller_setpoint_temperature');
        let ahu_opening_percentage=document.getElementsByName('ahu_opening_percentage')

        let cooling_water_temperature_setpoint_value;
        let chiller_setpoint_temperature_value;
        let ahu_opening_percentage_value;

        for (let i = 0; i < cooling_water_temperature_setpoint.length; i++) {
          if (cooling_water_temperature_setpoint[i].checked)
           cooling_water_temperature_setpoint_value= cooling_water_temperature_setpoint[i].value;
        }

        for (let i = 0; i < chiller_setpoint_temperature.length; i++) {
          if (chiller_setpoint_temperature[i].checked)
          chiller_setpoint_temperature_value= chiller_setpoint_temperature[i].value;
        }

        for (let i = 0; i < ahu_opening_percentage.length; i++) {
          if (ahu_opening_percentage[i].checked)
          ahu_opening_percentage_value= ahu_opening_percentage[i].value;
        }

        let data = {
          "cooling_water_temperature_setpoint": cooling_water_temperature_setpoint_value,
          "chiller_setpoint_temperature": chiller_setpoint_temperature_value,
          "ahu_opening_percentage": ahu_opening_percentage_value
        }

        const daygraph = document.querySelector("#daygraph");
        const graph=document.querySelector("#graph")

       console.log(data)


        try {
          const response = await fetch('https://yashwanthzodhya.pythonanywhere.com/saverxpredict_api', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          const result = await response.json();
         
          console.log(result)
          let Energy_Consumption_without_SaverX = result.Energy_Consumption_without_SaverX
          let Predicted_Energy_Consumption_with_SaverX = result.Predicted_Energy_Consumption_with_SaverX
          let Predicted_Savings=result.Predicted_Savings
          let monthly_image=result.monthly_url
          let img_url=result.img_url
          graph.setAttribute('src', img_url);
          daygraph.setAttribute('src',monthly_image)
          let button=document.getElementById('tooglebutton')
          button.style.display='block'

          let showdata = `Predicted Energy Consumption without SaverX:${Energy_Consumption_without_SaverX} kWh,  Predicted Energy Consumption with SaverX: ${Predicted_Energy_Consumption_with_SaverX} kWh, Predicted Savings: ${Predicted_Savings}%`
          document.getElementById('optimalresult').innerHTML = showdata


        } catch (error) {
          console.log(error);
        }


      })


    </script>

  </div>
</body>

</html>